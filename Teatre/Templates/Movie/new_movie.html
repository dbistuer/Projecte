{% extends "base.html" %}
{% block title %} New Movie {% endblock %}
{% block css %}
    .form-group{
        margin-bottom: 10px
    }
{% endblock %}
{% block body %}
{%  url 'new_movie' as new %}
 <div class="container" onload="set_choices()">
     <h1>Add Movie</h1>
     <hr/>
    <form method="POST">
      {% csrf_token %}
      <div class="form-group">
        <label for="frmName">Name</label>
        <input type="text" class="form-control" id="frmName" name="name"
            {% if request.path != new %}
               value="{{ movie.name }}"
            {% endif %}
            required>
      </div>
      <div class="row">
        <div class="form-group col-12 col-sm-12 col-md-6 col-lg-4 col-xl-3">
            <label for="frmGender">Gender</label>
            <select class="form-control" id="frmGender" name="gender" required></select>
        </div>
        <div class="form-group col-12 col-sm-12 col-md-6 col-lg-4 col-xl-3">
            <label for="frmClassification">Classification</label>
            <select class="form-control" id="frmClassification" name="classification" required></select>
        </div>
        <div class="form-group col-12 col-sm-12 col-md-2 col-lg-2 col-xl-1">
            <label for="frmDuration">Duration</label>
            <input type="number" class="form-control" id="frmDuration" name="duration"
                {% if request.path != new %}
                    value="{{ movie.duration }}"
                {% else %}
                    value="120"
                {% endif %}
                required>
        </div>
        <div class="form-group col-12 col-sm-12 col-md-8 col-lg-6 col-xl-6">
            <label for="frmImage">Cover</label>
            <input type="file" class="form-control" id="frmImage" name="image" accept=".png, .jpg"
                {% if request.path != new %}
                    value="{{ movie.image.url }}"
                {% endif %}
                required>
        </div>
      </div>
      <div class="form-group">
        <label for="frmDescription">Synopsis</label>
        <textarea class="form-control" id="frmDescription" name="synopsis" rows="3" required>{% if request.path != new %}{{ movie.synopsis }}{% endif %}</textarea>
      </div>
      <div class="input-group">
        <button class="btn btn-success" type="submit">Add</button>
      </div>
    </form>
 </div>
<script>
//GENRES
    $.ajax({
        url: "{{ api_url }}" + "genre/movie/list",
        data: {
            api_key: "{{ api_key }}"
        },
        success: function (result) {
            var choice = $("#frmGender");
            result.genres.forEach(gender => choice.append($('<option>', {
                value: gender.name,
                text: gender.name
            })));
        }
    });
//AGE CLASSIFICATION
    $.ajax({
        url: "{{ api_url }}" + "certification/movie/list",
        data: {
            api_key: "{{ api_key }}"
        },
        success: function (result) {
            var choice = $("#frmClassification");
            var certs = result.certifications.ES
                certs = certs.sort(function (e1, e2) {
                                      return (e1.order - e2.order);
                                    }).reverse();
            certs.forEach(classification => choice.append($('<option>', {
                value: classification.certification,
                text: classification.meaning,
                title: classification.meaning
            })));
        }
    });
//set values
    $(document).load(function () {
         set_choices();
    });
    function set_choice(gender,name){
        var choice = document.getElementsByName(name)
        choice.forEach(function(opti) {if(opti.id == gender){
            opti.attributes.setNamedItem('selected');
        }});
    }
    function set_choices(){
        if("{{ movie.gender }}" === "" && "{{ movie.classification }}" === ""){

        }else{
            set_choice("{{ movie.gender }}",'gender');
            set_choice("{{ movie.classification }}",'classification')
        }

    }

</script>
{% endblock %}